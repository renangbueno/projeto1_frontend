<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Leitor de QR Code</title>
<script src="https://unpkg.com/html5-qrcode@2.3.7/minified/html5-qrcode.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  #reader { width: 100%; max-width: 400px; margin-bottom: 20px; }
  #resultado { font-weight: bold; }
</style>
</head>
<body>
<h2>Escaneie o QR Code</h2>
<div id="reader"></div>
<div id="resultado">Aguardando leitura...</div>

<script>
  // Função que será chamada quando um QR Code for detectado
  function onScanSuccess(decodedText, decodedResult) {
    document.getElementById("resultado").innerHTML = `QR Code lido: ${decodedText}`;

    // Se for uma URL com parâmetros, extrai e mostra
    try {
      const url = new URL(decodedText);
      const params = new URLSearchParams(url.search);
      let html = '<h3>Parâmetros:</h3>';
      for (const [key, value] of params.entries()) {
        html += `<p>${key}: ${value}</p>`;
      }
      document.getElementById("resultado").innerHTML += html;

      // Opcional: parar a câmera depois de ler
      html5QrcodeScanner.clear();
    } catch(e) {
      console.log("Não é uma URL válida:", e);
    }
  }

  // Configuração da câmera
  let html5QrcodeScanner = new Html5Qrcode("reader");

  Html5Qrcode.getCameras().then(cameras => {
    if (cameras && cameras.length) {
      const cameraId = cameras[0].id; // Pega a primeira câmera disponível
      html5QrcodeScanner.start(
        cameraId, 
        { fps: 10, qrbox: 250 }, 
        onScanSuccess
      ).catch(err => {
        console.error("Erro ao iniciar a câmera:", err);
        document.getElementById("resultado").innerHTML = "Não foi possível acessar a câmera.";
      });
    } else {
      document.getElementById("resultado").innerHTML = "Nenhuma câmera encontrada.";
    }
  }).catch(err => {
    console.error("Erro ao listar câmeras:", err);
    document.getElementById("resultado").innerHTML = "Não foi possível acessar a câmera.";
  });
</script>
</body>
</html>
