<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Leitor de QR Code Traseira</title>
<script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  video { width: 100%; max-width: 400px; border: 1px solid #ccc; }
  #resultado { margin-top: 20px; font-weight: bold; white-space: pre-wrap; }
</style>
</head>
<body>
<h2>Escaneie o QR Code</h2>

<video id="video" autoplay playsinline></video>
<div id="resultado">Aguardando leitura...</div>

<script>
const videoElement = document.getElementById('video');
const resultadoDiv = document.getElementById('resultado');

Html5Qrcode.getCameras().then(cameras => {
  if (cameras && cameras.length) {
    // Tenta pegar a câmera traseira
    let backCamera = cameras.find(cam => cam.label.toLowerCase().includes('back') || cam.label.toLowerCase().includes('traseira'));
    if (!backCamera) backCamera = cameras[0]; // fallback se não encontrar

    navigator.mediaDevices.getUserMedia({ video: { deviceId: backCamera.id } })
      .then(stream => {
        videoElement.srcObject = stream;

        const html5QrCode = new Html5Qrcode("reader-placeholder");
        html5QrCode.start(
          backCamera.id,
          { fps: 10, qrbox: 250, aspectRatio: 1.333 },
          decodedText => {
            resultadoDiv.textContent = decodedText;
          },
          errorMessage => {
            // erros momentâneos ignorados
          }
        );
      })
      .catch(err => {
        resultadoDiv.textContent = "Não foi possível acessar a câmera: " + err;
      });
  } else {
    resultadoDiv.textContent = "Nenhuma câmera encontrada.";
  }
}).catch(err => {
  resultadoDiv.textContent = "Erro ao listar câmeras: " + err;
});
</script>
</body>
</html>
